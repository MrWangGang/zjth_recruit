<scroll-view class="container" scroll-y>

<view class="background-image-container">
    <image class="background-image" src="{{cloudPaths.background}}" mode="widthFix"></image>
</view>

<view class="user-card" style="padding-top: {{statusBarHeight}}px;">
    <view class="user-main-info">
        <image class="user-avatar" src="{{userInfo.avatar}}" mode="aspectFill"></image>
        <view class="name-phone">
            <text class="user-name">{{userInfo.name}}</text>
            <block wx:if="{{userInfo.phone}}">
                <text class="user-phone">{{userInfo.phone}}</text>
            </block>
            <block wx:else>
                <text class="user-phone empty-text" bindtap="goToEditProfile">è¯·å®Œå–„ä¸ªäººä¿¡æ¯</text>
            </block>
        </view>
        <view class="nav-buttons">
            <view class="nav-button" bindtap="goToEditProfile"><image class="nav-icon" src="{{cloudPaths.editIcon}}"></image></view>
            <view class="nav-button" bindtap="goToSettings"><image class="nav-icon" src="{{cloudPaths.settingIcon}}"></image></view>
        </view>
    </view>
</view>

<view class="pets-section">
    <image class="meow-bubble" src="{{cloudPaths.bubble}}" mode="aspectFit"></image>

    <block wx:if="{{deliveries.length > 0}}">
        <view class="delivery-list-container">
            <view class="delivery-card">
                <image class="delivery-card__avatar" src="{{deliveries[0].image}}" mode="aspectFill"></image>
                <view class="delivery-card__details">
                    <view class="delivery-card__name-line">
                        <text class="delivery-card__name">{{deliveries[0].job_name}}</text>
                    </view>
                    <text class="delivery-card__desc">è–ªèµ„: {{deliveries[0].salary_range}}</text>
                </view>
                <view class="delivery-card__button" bindtap="goToDeliveryDetail" data-job-id="{{deliveries[0].job_id}}">æŸ¥çœ‹è¯¦æƒ…</view>
            </view>
        </view>
    </block>

    <block wx:else>
        <view class="pet-card">
            <image class="pet-card__avatar" src="{{cloudPaths.defaultAvatar}}"></image>
            <view class="pet-card__details">
                <text class="pet-card__name">æ‚¨è¿˜æ²¡æœ‰æŠ•é€’è¿‡èŒä½</text>
                <text class="pet-card__desc">æ¬¢è¿åŠ å…¥æˆ‘ä»¬çš„å¤§å®¶åº­,ç¦åˆ©å¤šå¤š</text>
            </view>
            <view class="pet-card__button" bindtap="goToWork">å»æŠ•é€’</view>
        </view>
    </block>
</view>
<view class="tabs-container">
    <view class="tab-header active" data-tab="delivery" bindtap="switchTab">æˆ‘çš„æŠ•é€’</view>
</view>

<view class="tab-content">
    <view class="delivery-list" wx:if="{{activeTab === 'delivery'}}">
        <block wx:if="{{deliveries.length > 0}}">
            <view class="delivery-item" wx:for="{{deliveries}}" wx:key="_id" bindtap="goToDeliveryDetail" data-job-id="{{item.job_id}}">

                <view class="delivery-img-wrap">
                    <image class="delivery-img" src="{{item.image}}" mode="aspectFill" lazy-load="true"></image>

                </view>

                <view class="delivery-details">
                    <view>
                        <view class="delivery-title">{{item.job_name}}</view>

                        <!-- 1. æŠ•é€’æ—¥æœŸ (æ–‡æœ¬å›¾æ ‡: ğŸ•’) -->
                        <view class="delivery-info-line">
                            <text class="activity-info-icon time-icon">ğŸ•’</text>
                            <text class="delivery-time">æŠ•é€’ï¼š{{item.deliver_date}}</text>
                        </view>

                        <!-- 2. èŒä½ç±»å‹ (æ–‡æœ¬å›¾æ ‡: ğŸ“Œ) -->
                        <view class="delivery-info-line">
                            <text class="activity-info-icon type-icon">ğŸ“Œ</text>
                            <text class="delivery-type">ç±»å‹ï¼š{{item.job_type}}</text>
                        </view>
                        
                        <!-- 3. è–ªèµ„èŒƒå›´ (ä½¿ç”¨ ğŸ’° å›¾æ ‡) -->
                        <view class="delivery-info-line">
                            <text class="activity-info-icon salary-icon">ğŸ’°</text>
                            <text class="delivery-salary">è–ªèµ„ï¼š{{item.salary_range}}</text>
                        </view>

                        <!-- 4. èŒä½èŒè´£ (ä½¿ç”¨ âœï¸ å›¾æ ‡) -->
                        <view class="delivery-info-line">
                            <text class="activity-info-icon job-duty-icon">âœï¸</text>
                            <text class="delivery-desc">èŒè´£ï¼š{{item.job_duty}}</text>
                        </view>

                    </view>
                </view>
            </view>
        </block>

        <block wx:if="{{isLoadMore}}">
            <view class="loading-more">æ­£åœ¨åŠ è½½...</view>
        </block>

        <block wx:elif="{{!hasMore && deliveries.length > 0}}">
            <view class="empty-state">--- å·²ç»åˆ°åº•äº† ---</view>
        </block>

        <block wx:elif="{{deliveries.length === 0 && !isLoadMore}}">
            <view class="empty-state">æš‚æ— ç›¸å…³æŠ•é€’è®°å½•</view>
        </block>
    </view>
</view>
</scroll-view>

<authorize bindloginsuccess="onLoginSuccess" wx:if="{{!isLoggedIn}}"></authorize>